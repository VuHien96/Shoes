<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/layout/layout :: main-fragment(
                                                                     ~{:: title},
                                                                    'header',
                                                                    'footer',
                                                                     ~{:: #css-resources},
                                                                     ~{:: #js-resources},
                                                                     ~{:: #main-content}
                                                                    )}">
<head>
    <meta charset="UTF-8">
    <title th:text="${product.name}"></title>
    <th:block id="css-resources">
        <link rel="stylesheet" th:href="@{/shop/css/custom.css}">
    </th:block>
</head>
<body>
<main class="main" id="main-content">
    <div class="container">
        <nav aria-label="breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/"><i class="icon-home"></i></a></li>
                <li class="breadcrumb-item" th:text="${product.name}"></li>
            </ol>
        </nav>
        <div class="product-single-container product-single-default">
            <div class="row">
                <div class="col-md-6 product-single-gallery">
                    <div class="product-slider-container">
                        <div class="product-single-carousel owl-carousel owl-theme">
                            <th:block th:each="img :${product.productImages}">
                                <div class="product-item">
                                    <img class="product-single-image" th:src="${img}" th:attr="data-zoom-image=${img}"/>
                                </div>
                            </th:block>
                        </div>
                        <!-- End .product-single-carousel -->
                        <span class="prod-full-screen"><i class="icon-plus"></i></span>
                    </div>
                    <div class="prod-thumbnail owl-dots" id='carousel-custom-dots'>
                        <th:block th:each="img :${product.productImages}">
                            <div class="owl-dot">
                                <img th:src="${img}"/>
                            </div>
                        </th:block>
                    </div>
                </div><!-- End .product-single-gallery -->

                <div class="col-md-6 product-single-details">
                    <h1 class="product-title" th:text="${product.name}"></h1>

                    <div class="ratings-container">
                        <div class="product-ratings">
                            <span class="ratings" style="width:60%"></span><!-- End .ratings -->
                        </div><!-- End .product-ratings -->

                        <a href="#" class="rating-link">( 6 Reviews )</a>
                    </div><!-- End .ratings-container -->

                    <hr class="short-divider">

                    <div>
                        <span class="desc-sub-title">Giá sản phẩm: </span>
                        <th:block th:if="${product.promotionPrice}">
                            <span class="product-price price-box" th:text="${#numbers.formatDecimal(product.promotionPrice, 0, 'COMMA', 0, 'POINT') +' đ'}"></span>
                            <del class="old-price " th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') +' đ'}"></del>
                        </th:block>
                        <th:block th:unless="${product.promotionPrice}">
                            <span class="product-price price-box" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') +' đ'}"></span>
                        </th:block>
                    </div><!-- End .price-box -->
                    <hr class="divider">
                    <div class="product-desc">
                        <span class="desc-sub-title">Đã bán: </span>
                        <span th:text="${product.totalSold} + ' đôi'"></span>
                    </div>
                    <hr class="divider">
                    <div class="product-desc">
                        <span class="desc-sub-title">Tình trạng: </span>
                        <span th:if="${canBuy}">Còn hàng</span>
                        <span th:unless="${canBuy}" style="color:#f04e40">Tạm hết hàng</span>
                    </div>
                    <hr class="divider">

                    <div class="btns">
                        <div class="size-btn" data-toggle="modal" data-target="#modal-size-Choose">
                            <button class="btn btn-primary size trans-btn">
                                <span class="size-text">Size</span>
                                <span class="size-details"></span>
                                <i class="fas fa-chevron-down dropdown-arrow"></i>
                            </button>
                        </div>
                        <div class="buy-btn">
                            <button class="btn btn-primary buy red-btn" th:classappend="${canBuy} == true ? '' : 'not-buy'">
                                <div class="ask-text left-content">
                                    <th:block th:if="${product.promotionPrice}">
                                        <div class="ask-desc sub-content old-price"><span class="text-price" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') +' đ'}"></span> &#x20AB;</div>
                                        <div class="ask-price "><span class="text-price" th:text="${#numbers.formatDecimal(product.promotionPrice, 0, 'COMMA', 0, 'POINT') +' đ'}"></span> &#x20AB;</div>
                                    </th:block>
                                    <th:block th:unless="${product.promotionPrice}">
                                        <div class="ask-desc sub-content">Giá bán ưu đãi</div>
                                        <div class="ask-price "><span class="text-price" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') +' đ'}"></span> &#x20AB;</div>
                                    </th:block>
                                </div>
                                <div class="buy-text right-content">
                                    <div class="buy-now ">Mua ngay</div>
                                </div>
                            </button>
                        </div>
                    </div>
                    <hr class="divider mb-1">

                    <div class="product-single-share">
                        <label class="sr-only">Share:</label>

                        <div class="social-icons mr-2">
                            <a href="#" class="social-icon social-facebook icon-facebook" target="_blank" title="Facebook"></a>
                            <a href="#" class="social-icon social-twitter icon-twitter" target="_blank" title="Twitter"></a>
                            <a href="#" class="social-icon social-linkedin fab fa-linkedin-in" target="_blank" title="Linkedin"></a>
                            <a href="#" class="social-icon social-gplus fab fa-google-plus-g" target="_blank" title="Google +"></a>
                            <a href="#" class="social-icon social-mail icon-mail-alt" target="_blank" title="Mail"></a>
                        </div><!-- End .social-icons -->

                        <a href="#" class="add-wishlist" title="Add to Wishlist">Add to Wishlist</a>
                    </div><!-- End .product single-share -->
                </div><!-- End .product-single-details -->
            </div><!-- End .row -->
        </div><!-- End .product-single-container -->

        <div class="product-single-tabs">
            <ul class="nav nav-tabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="product-tab-desc" data-toggle="tab" href="#product-desc-content" role="tab" aria-controls="product-desc-content" aria-selected="true">Mô tả chi tiết sản phẩm</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="product-tab-more-info" data-toggle="tab" href="#product-more-info-content" role="tab" aria-controls="product-more-info-content" aria-selected="false">Hình ảnh feedback</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="product-tab-reviews" data-toggle="tab" href="#product-reviews-content" role="tab" aria-controls="product-reviews-content" aria-selected="false">Đánh giá sản phẩm</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="product-desc-content" role="tabpanel" aria-labelledby="product-tab-desc">
                    <div class="product-desc-content">
                        <p th:utext="${product.description}"></p>
                    </div><!-- End .product-desc-content -->
                </div><!-- End .tab-pane -->

                <div class="tab-pane fade fade" id="product-more-info-content" role="tabpanel" aria-labelledby="product-tab-more-info">
                    <div class="product-desc-content">
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat.</p>
                    </div><!-- End .product-desc-content -->
                </div><!-- End .tab-pane -->

                <div class="tab-pane fade" id="product-tags-content" role="tabpanel" aria-labelledby="product-tab-tags">
                    <div class="product-tags-content">
                        <form action="#">
                            <h4>Add Your Tags:</h4>
                            <div class="form-group">
                                <input type="text" class="form-control form-control-sm" required>
                                <input type="submit" class="btn btn-dark" value="Add Tags">
                            </div><!-- End .form-group -->
                        </form>
                        <p class="note">Use spaces to separate tags. Use single quotes (') for phrases.</p>
                    </div><!-- End .product-tags-content -->
                </div><!-- End .tab-pane -->

                <div class="tab-pane fade" id="product-reviews-content" role="tabpanel" aria-labelledby="product-tab-reviews">
                    <div class="product-reviews-content">
                        <div class="row">
                            <div class="col-xl-7">
                                <h2 class="reviews-title">3 reviews for Product Long Name</h2>

                                <ol class="comment-list">
                                    <li class="comment-container">
                                        <div class="comment-avatar">
                                            <img src="assets/images/avatar/avatar1.jpg" width="65" height="65" alt="avatar"/>
                                        </div><!-- End .comment-avatar-->

                                        <div class="comment-box">
                                            <div class="ratings-container">
                                                <div class="product-ratings">
                                                    <span class="ratings" style="width:80%"></span><!-- End .ratings -->
                                                </div><!-- End .product-ratings -->
                                            </div><!-- End .ratings-container -->

                                            <div class="comment-info mb-1">
                                                <h4 class="avatar-name">John Doe</h4> - <span class="comment-date">Novemeber 15, 2019</span>
                                            </div><!-- End .comment-info -->

                                            <div class="comment-text">
                                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip.</p>
                                            </div><!-- End .comment-text -->
                                        </div><!-- End .comment-box -->
                                    </li><!-- comment-container -->

                                    <li class="comment-container">
                                        <div class="comment-avatar">
                                            <img src="assets/images/avatar/avatar2.jpg" width="65" height="65" alt="avatar"/>
                                        </div><!-- End .comment-avatar-->

                                        <div class="comment-box">
                                            <div class="ratings-container">
                                                <div class="product-ratings">
                                                    <span class="ratings" style="width:80%"></span><!-- End .ratings -->
                                                </div><!-- End .product-ratings -->
                                            </div><!-- End .ratings-container -->

                                            <div class="comment-info mb-1">
                                                <h4 class="avatar-name">John Doe</h4> - <span class="comment-date">Novemeber 15, 2019</span>
                                            </div><!-- End .comment-info -->

                                            <div class="comment-text">
                                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip.</p>
                                            </div><!-- End .comment-text -->
                                        </div><!-- End .comment-box -->
                                    </li><!-- comment-container -->

                                    <li class="comment-container">
                                        <div class="comment-avatar">
                                            <img src="assets/images/avatar/avatar3.jpg" width="65" height="65" alt="avatar"/>
                                        </div><!-- End .comment-avatar-->

                                        <div class="comment-box">
                                            <div class="ratings-container">
                                                <div class="product-ratings">
                                                    <span class="ratings" style="width:80%"></span><!-- End .ratings -->
                                                </div><!-- End .product-ratings -->
                                            </div><!-- End .ratings-container -->

                                            <div class="comment-info mb-1">
                                                <h4 class="avatar-name">John Doe</h4> - <span class="comment-date">Novemeber 15, 2019</span>
                                            </div><!-- End .comment-info -->

                                            <div class="comment-text">
                                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip.</p>
                                            </div><!-- End .comment-text -->
                                        </div><!-- End .comment-box -->
                                    </li><!-- comment-container -->
                                </ol><!-- End .comment-list -->
                            </div>

                            <div class="col-xl-5">
                                <div class="add-product-review">
                                    <form action="#" class="comment-form m-0">
                                        <h3 class="review-title">Add a Review</h3>

                                        <div class="rating-form">
                                            <label for="rating">Your rating</label>
                                            <span class="rating-stars">
														<a class="star-1" href="#">1</a>
														<a class="star-2" href="#">2</a>
														<a class="star-3" href="#">3</a>
														<a class="star-4" href="#">4</a>
														<a class="star-5" href="#">5</a>
													</span>

                                            <select name="rating" id="rating" required="" style="display: none;">
                                                <option value="">Rate…</option>
                                                <option value="5">Perfect</option>
                                                <option value="4">Good</option>
                                                <option value="3">Average</option>
                                                <option value="2">Not that bad</option>
                                                <option value="1">Very poor</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label>Your Review</label>
                                            <textarea cols="5" rows="6" class="form-control form-control-sm"></textarea>
                                        </div><!-- End .form-group -->


                                        <div class="row">
                                            <div class="col-md-6 col-xl-12">
                                                <div class="form-group">
                                                    <label>Your Name</label>
                                                    <input type="text" class="form-control form-control-sm" required>
                                                </div><!-- End .form-group -->
                                            </div>

                                            <div class="col-md-6 col-xl-12">
                                                <div class="form-group">
                                                    <label>Your E-mail</label>
                                                    <input type="text" class="form-control form-control-sm" required>
                                                </div><!-- End .form-group -->
                                            </div>
                                        </div>

                                        <input type="submit" class="btn btn-dark ls-n-15" value="Submit">
                                    </form>
                                </div><!-- End .add-product-review -->
                            </div>
                        </div>
                    </div><!-- End .product-reviews-content -->
                </div><!-- End .tab-pane -->
            </div><!-- End .tab-content -->
        </div><!-- End .product-single-tabs -->

        <div class="products-section pt-0">
            <h2 class="section-title">Sản phẩm liên quan</h2>

            <div class="products-slider owl-carousel owl-theme dots-top">
                <th:block th:each="related : ${relatedProducts}">
                    <div class="product-default inner-quickview inner-icon">
                        <figure>
                            <a th:href="@{/{slug}/{id}(id=${related.id},slug=${related.slug})}">
                                <img th:src="${related.images}">
                            </a>
                            <div class="btn-icon-group">
                                <button class="btn-icon btn-add-cart" data-toggle="modal" data-target="#addCartModal"><i class="icon-shopping-cart"></i></button>
                            </div>
                        </figure>
                        <div class="product-details">
                            <h3 class="product-title">
                                <a th:href="@{/{slug}/{id}(id=${related.id},slug=${related.slug})}" th:text="${related.name}"></a>
                            </h3>
                            <div class="ratings-container">
                                <div class="product-ratings">
                                    <span class="ratings" style="width:100%"></span><!-- End .ratings -->
                                    <span class="tooltiptext tooltip-top"></span>
                                </div><!-- End .product-ratings -->
                            </div><!-- End .ratings-container -->
                            <div class="price-box">
                                <th:block th:if="${related.promotionPrice}">
                                    <span class="product-price" th:text="${#numbers.formatDecimal(related.promotionPrice, 0, 'COMMA', 0, 'POINT') +' đ'}"></span>
                                    <del class="old-price" th:text="${#numbers.formatDecimal(related.price, 0, 'COMMA', 0, 'POINT') +' đ'}"></del>
                                </th:block>
                                <th:block th:unless="${related.promotionPrice}">
                                    <span class="product-price" th:text="${#numbers.formatDecimal(related.price, 0, 'COMMA', 0, 'POINT') +' đ'}"></span>
                                </th:block>
                            </div><!-- End .price-box -->
                        </div><!-- End .product-details -->
                    </div>
                </th:block>
            </div><!-- End .products-slider -->
        </div><!-- End .products-section -->
    </div><!-- End .container -->

    <!-- Modals-->
    <th:block th:replace="~{fragment/size_choose_modal :: size-choose-modal}"></th:block>
</main><!-- End .main -->

<th:block id="js-resources">
    <script th:src="@{/shop/js/size-choose.js}"></script>

    <script th:inline="javascript">
        let sizeVn = [[${sizeVn}]];

        let sizeUs = [[${sizeUs}]];

        let sizeCm = [[${sizeCm}]];

        $(function () {
            render();
            activeSize();
            sizeGuideRender();
        });

        function render() {
            for (let i = 0; i < sizeVn.length; i++) {
                let sizeChoose = `
            <div class="item" data-size="${sizeUs[i]}US | ${sizeVn[i]}VN | ${sizeCm[i]}CM" data-id="${sizeVn[i]}">
                ${sizeVn[i]}
            </div>
            `;

                $('.size .select-filter').append(sizeChoose);
            };
        };

        function sizeGuideRender() {
            let tr = '';
            for (let i = 0; i < sizeVn.length; i++) {
                tr += `
            <tr>
              <td>${sizeVn[i]}</td>
              <td>${sizeUs[i]}</td>
              <td>${sizeCm[i]}</td>
            </tr>
            `;
            }
            $('.side-guide-table tbody').html(tr);
        }

        function activeSize() {
            let availableSizes = [[${availableSizes}]]

            for (let i = 0; i < sizeVn.length; i++) {
                if (sizeVn[i] == availableSizes[0]) {
                    $('.size-details').text(sizeUs[i] + "US | " + sizeVn[i] + "VN | " + sizeCm[i] + "CM")
                    break;
                }
            }

            $('.size .item').addClass('cross')
            $(`.item[data-size='${$('.size-details').text()}']`).addClass('size-choose').removeClass('cross');

            for (let i = 0; i < availableSizes.length; i++) {
                $(`.item[data-id='${availableSizes[i]}']`).removeClass('cross');
            }
        }

        $('.buy-now').click(function() {
            if (isLogined == true) {
                let size = $('.size-choose').data("id");
                if (size == null || size == "") {
                    toastr.warning("Sản phẩm tạm hết hàng. Vui lòng đặt hàng sau.");
                } else {
                    location.href = "/dat-hang?id="+[[${product.id}]]+"&size="+size;
                }
            } else {
                toastr.warning("Vui lòng đăng nhập để đặt hàng");
                setTimeout(function() {
                    $('#exampleModal').modal('show');
                }, 500);
            }
        })
    </script>
</th:block>
</body>
</html>